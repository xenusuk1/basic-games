'original code

GOSUB 740 
GOSUB 600

7 PRINT"YOU APE IN A "; Z$ ; GOSUB 2140

8 GOSUB 400 :GOSUB 2700 : GOTO 1500


10 C$="SPPRINED RN ANKLE" : RETURN

15 C$="TRIPPED OVER A BRICK"  : RETURN

20 C$="BEEN STUNG BY A BEE" : RETURN

25 C$="BEEN ATTRCKED BY VRMPIRE BATS" : RETURN

30 C$="BEEN BITTEN BY A MAD DOG" : RETURN

35 C$="BEEN PLAGUED BY KILLER MOTHS"  : RETURN

40 C$="STEPPED ON A RAKE" : RETURN

45 C$="CONTRACTED A BAD COUGH" : RETURN

50 C$="STUMBLED TO THE GROUND" : RETURN

55 C$="HAD A BAD FALL" : RETURN

60 C$="SLIPPED ON A BANANA SKIN" : RETURN

65 C$="BUMPED INTO A WALL" : RETURN

' monster list
100 T=0: FOR I=1 TO NM Q=PEEK B2+2*I+2
110 IF Q=N THEN T=T+1 ; T%(T)=I : IF T=9 THEN I=NM
120 NEXT : V=T%(FNR(T): RETURN

'find exits
200 T=0 : FOR I = 1 TO 5 : Q=PEEK(B1+6*N-6+1) AND 31
210 IF Q THEN T*T+1  : T%(T) =Q
220 NEXT : R=FNR(T) :  M=T%(R)
' get door type
230 D=INT(PEEK(B1+6*N-6+R)/32)+8*((N+M) AND 1) : RETURN

' item list
300 T=0 FOR I = 1 TO NI : PEEK (B3+2*I)
310 IF Q=N THEN T=T+1  : T%(T) = I : IF T=9 THEN I=NI
320 NEXT : U=T%(FNR(T)) : RETURN

' wait for keypress
400 PRINT L$;"PRESS SPACE TO CONTINUE"
410 GET A$ IF A$ <>" " THEN 410
420 RETURN

' display something
500 SYS988 : PRINT"«H«" : GOSUB 950 : RETURN
600 SYS 1002 : PRINT "JffllfMKPlUlPli'lPlflf'IKIi'W" : GOSUB950 : RETURN

' read through data strings
700 C=NM+E■ : GOTO 800
720 C=V: GOT0 800
740 C=16+NM+NI+N : GOTO 800
760 C=1+NM+NI+D
800 RESTORE: FOR I=0 TO C : READZ$ : NEXT :RETURN

'input char
900 INPUT A$
910 Q=ASC(A$-48) : RETURN

'Delay loop
950 FOR I=1 TO 550: NEXT : RETURN

'Main loop
1500 ON FNR(5) GOSUB 1700,4000,4000,4800,4700
1550 PRINT L$ : GOSUB 950 : GOTO 1500

' Action sub
1700 PRINT L$; " VOUR ACTION " :GOSUB 900
1720 IF Q<1  OR Q>9 THEN 1800

1730 ON Q GOSUB 2000 2300,2400,2500,2600, 2700,2800, 2900,2200 
1750 RETURN


1800 GOSUB 500 : PRINT"S VOUR OPTIONS W "
1810 PRINT"1.MOVE "
1820 PRINT"2.SEARCH ROOM "
1830 PRINT"3.TAKE ITEM"
1840 PRINT"4.DROP ITEM" 
1850 PRINT "CHECK  EXITS "
1860 PRINT"6.CHECK POSSESSIONS "
1870 PRINT"7.EVALUATE ITEM "
1880 PRINT "* 8. CHECK OCCUPANTS "
1890 PRINT"9.ATTACK"  : GOTO 1700

'Move
2000 P=N :N=64 : GOSUB 300: N=P  : IF T>FNR(14) THEN GOSUB 4600 
2010 GOSUB 200 PRINT L$;"WHICH EXIT";
2020 GOSUB 900 IF Q<1 OR Q>T THEN 2010
2030 M=T%(Q) : R=Q : GOSUB 230 : IF D=0 THEN 6000
2040 GOSUB 600 IF PEEK(B2+1)>FNR(55+5*D) THEN 2060 
2050 PRINT"VOU CAN'T" : RETURN
2060 N=T%(R) : POKE(B2+2,N) : G=0
2070 GOSUB 740 :A$=Z$ : GOSUB 760
2080 PRINT"VOU HAVE ENTERED A ";A$
2090 PRINT"VIA A "; Z$ : IF N>1 THEN 2140

2110 PRINT "WOU HAVE BEEN HEALED ' !"
2120 PRINT".WOU APE BACK TO FULL STRENGTH" : POKE (B2+1,255) 
2140 GOSUB 2900 : GOSUB 400 : GOSUB 2600 : RETURN 

'Attack
2200 GOSUB  100:IF T THEN 2230
2220 GOSUB 600 : PRINT"THERE'S NOBOPV THERE!!»" : RETURN
2230 PRINT L$,"ATTACK WHO": GOSUB 990
2240 IF Q<1 OR Q>T THEN 4030
2250 P=0 : X=0 : Y=T%(Q) : GOTO 4030

2300 G=1 : GOSUB 500 : PRINT " YOU FIND-"
2310 GOSUB 300 : IF T=0 OR FNR(9)>7 THEN 2340
2320 FOR J=1 TO T : E=T%(J): GOSUB 700
2330 PRINT J;"A ";Z$ : NEXT:RETURN
2340 PRINT"NOTHING!!'"RETURN

2400 GOSUB 300 ; IF T>0 AND FNR(5)<5*G THEN 2420
2410 GOSUB 600 : PRINT"NOTHING FOUND TO TAKE!" RETURN 
2420 PRINT L$; " TAKE ITEM# "; : GOSUB 900
2425 IF Q<1 OR Q>T THEN 2420
2430 E=T%(Q) : POKE B3+2*E,64  : GOSUB 700
2440 GOSUB 600 : PRINT"VOU HAVE PICKED UP A ";Z$ RETURN

2500 P=N : N=64 : GOSUB 300 : N=P : IF T THEN 2530
2520 GOSUB 600 : PRINT " VOU HAVE NOTHING." : RETURN
2530 PRINT L$;"DROP ITEM#", GOSUB 900
2535 IF Q<1 OR Q>T THEN 2530
2540 E=T%(Q) : POKE B3+2*E,N : GOSUB 700
2550 GOSUB 600 : PRINT"A "; Z$ : PRINT"HAS BEEN DROPPED" : RETURN


2600 GOSUB 500 : PRINT"THE EXITS ARE"
2610 GOSUB 200 : FOR I=1 TO T : M=T%(R)
2620 GOSUB 230 : GOSUB 760 : PRINT R; "A "; Z$ : NEXT : RETURN 

2700 GOSUB 500 : PRINT"VOU POSSESS : "
2710 P=N : N=64 : GOSUB300:N=P : IF T=0 THEN 2340 
2720 GOTO 2320

2800 P=N=N=64:GOSUB 300 ; N=P : IF T=9 THEN 2520 
2810 PRINT L#;"EVALUATE ITEM#"; GOSUB 900
2820 I FQ< 10R Q>T THEN 2810
2830 E=TX ( Q > : GOSUB 700 : GOSUB 600
2840 PRINT"A ";Z#;" IS WORTH";PEEK<B3+2*E-1 > : PRINT"GOLD PIECES" : RETURN

2900 GOSUB500 ; PRINT"3 IN THE ROOM IS W"
2910 GOSUB100 N=N+99 F0R I=1 TO NM
2920 IF PEEK(B2+2*1+2)=N THEN T=T+1 : T%(T )=I+99 : IF T=9 THEN I=NM
2930 NEXT : N=N-99 : IF T THEN 2940
2935 PRINT"NO-ONE.VOU'RE QUITE ALONE" : RETURN
2940 F0R J=1 TO T:V=T%(J) IF V>99 THEN V=V-99
2950 GOSUB720 : IF T%(J)>99 THEN Z$=Z$+" <DEAD> "
2960 PRINT J;Z# NEXT:RETURN

' Fighting
4000 GOSUB 100 : IF T=0 THEN RETURN
4010 ON FNR(5) GOTO 4300,4400 4500
'Attack
4020 X=V : P=0 : GOSUB 100 : Y=V
4030 GOSUB 600 : IF X=Y THEN Y=0 : P=1

4040 V=X : GOSUB 720 :'A$=Z$
4050 V=Y  : G0SUB 720 : C$=Z$
4060 U=FNR((9+PEEK(B2+2*X+1) /9 ) * (1.6+ (Y=0) -60*RND(1)>.95 ))
4070 B$=" DEALT A MIGHTY"+CHR$(13)+"BL0W TO "
4080 IF U<50 THENB$=" MADE A VICIOUS"^CHR$(13)+"ASSAULT ON "
4085 IF UK33 THENB$=" INFLICTED A"+CHR$(13)+"LIGHT WOUND ON "
4090 IF U<9 THENB$=" MISSED " U=0 : IF LEN(A$)+LEN(C$)>31 THEN RETURN 

4100 PRINTA$;B$;C$

4105 C#="VOU ARE "
4110 IF Y>0 THEN C$="HE IS "
4120  IF Y>17 THEN C$="SHE IS "
4130 IF Y>24 THEN C$ = "IT IS "
4140 K=PEEK (B2+2*Y+1)-U : IF K<1 THEN 4230
4150 POKE (B2+2*Y+1,,K) : IF U=0 OR FNR(9)> 7 THEN 4210
4160 B$="N0T BADLY HURT" : IF FNR(5)>3 THEN B$="STILL O.K."
4170 IF K< 130 THEN B$="SLIGHTLY WOUNDED"
4190 IF K<75 THEN B$="SERIOUSLY INJURED"
4190 IF K<40 THEN B$="CRAWLING ON THE GROUND!!" : P=1
4200 PRINT C$ ,B$

'hit back
4210 PRINT:IF FNR(9)<4 OR P THEN RETURN
4220 P=X: X=Y : Y=P : P=1 : A$=LEFT$(C$,3) : GOTO 4050
4230 PRINT S*;"DEAD!!" IF Y=0 THEN 5000
4240 POKE B2+2*Y+1,0 : POKE B2+2*Y+2,N+99
4250 FOR I=1 TO NI
4260 IF PEEK ( B3+2*I)=Y+64 THEN POKE (B3+2*I,N)
4270 NEXT : RETURN

' Monster Leave
4300 GOSUB 200 : GOSUB 720 : A$=Z$ :G0SUB 760 : GOSUB 600
4310 IF PEEK (B2+2*V+1)>(FNR(9)*D+88) THEN 4340
4320 PRINT A$;" TRIED UNSUCCESS-
4330 PRINT"FULLY TO LEAVE ";GOTO 4350
4340 POKE (B2+2*V+2,M) : PRINT A$;" HAS LEFT"
4350 PRINT "BY A ";Z$  : RETURN

' Monster Pick
4400 GOSUB 300 : IF T=0 THEN RETURN
4410 POKE (E3+2*U, 64+'V) ; GOSUB720
4420 GOSUB 600 : PRINT Z$;" HAS PICKED " ; PRINT"UP SOMETHING" RETURN

' Drop from V random
4500 P=N :H=64+V : GOSUB 300 : N=P
4510 IF T=0 OR PEEK ( B2+2*V+1)>20*T+FNR(59)+5*U*(V=0)) THEN RETURN
4520 POKE (B3+2*U,N) GOSUB 720
4530 IF V=0 THEN Z$="YOU HAVE"
4540 GOSUB 600 : PRINT Z$; " DROPPED SOMETHING " : RETURN

' You Drop
4600 V=0 :GOTO 4500

' Monster arrive
4700  GOSUB 200 R=N N=M
4710 GOSl IB100 N=R IF T=0 THEN RETURN
4715 IF FNR(9 > >5 THEN 4800
4710 G0SUB 109 ; N=R• IF T-6 THEN RETURN
4715 IF FNR ( 9> >5 THEN 4800
4730 GOSUB 720 hS=Z$■ GOSUB 760
4740 GOSUB 600 : PRINT A*; " HRS ENTERED VIA
4750 PRINT"fi ";ZS P0KE B2+2*V+2,N : RETURN

' Random action
4800 IF FNRR(9) >2 THEN RETURN
4810 ON FNR(12) GOSUB 10,15,20,25,30,35,40,45,50,55,60,65
4820 GOSUB 100 : GOSUB 720 : IF T=0 OR FNR(7 )>5 THEN V=0
4830 IF V=0 THEN C$="YOU HAVE "+C$ GOTO 4850
4840 C$= Z$+ " HAS " +CHR* (13)+C$
4850 GOSUB 600 : PRINT C$ :U=FNR(20)
4860 P=1 : Y=V : GOTO4105

'lost
5000 PRINT"YOU DIED OF YOUR WOUNDS-NEXT TIME LOOK-"

5010 PRINT "FOR FIRST AID OR KEEP OUT OF FIGHTS"

5020 GO9UB 500 : PRINT"YOU DIED POSSESSING•»" :G0SUB 2710

5030 PRINT"LOAD FANTASY 1 FOR A NEW GAMES" ; END

'won?
6000 T=0:FOR I = 1 TO N :X=B3+2*I

6920 IF PEEK(X)=64 THEN T=T+PEEK(X-1)

6030 NEXT :GOSUB 600 : IF T<1000 THEN 6100

6040 PRINT"THE GOLDEN DOOR OPENS!!!"

6059 PRINT"YOU HAVE TREASURE TO THE VALUE OF"

6060 PRINT T;"GOLD PIECES-YOU ARE A HERO!!"

6070 GOTO 5030

6100 PRINT"YOU CAN'T-YOUR TREASURE IS"
 
6110 PRINT"ONLY WORTH";TJ"GOLD PIECES" : RETURN
 
